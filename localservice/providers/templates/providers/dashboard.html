{% extends "providers/base.html" %}
{% block content %}

<div style="display:flex; justify-content:space-between; align-items:center;">
    <h2>Welcome, {{ provider.full_name }}</h2>
    
    <!-- Logout button -->
    <form method="POST" action="{% url 'providers:logout' %}">
        {% csrf_token %}
        <button type="submit" class="btn">Logout</button>
    </form>
</div>

<div class="stats-box">
    <p><strong>Total Services:</strong> {{ services|length }}</p>
    <p><strong>Total Slots:</strong> {{ slots|length }}</p>
    <p><strong>Total Bookings:</strong> {{ total_bookings }}</p>
</div>

<hr>

<h3>Your Services</h3>
<a href="{% url 'providers:add_service' %}" class="btn">➕ Add Service</a>

<table class="list-table">
    <tr>
        <th>Service</th>
        <th>Category</th>
    </tr>
    {% for s in services %}
    <tr>
        <td>{{ s.title }}</td>
        <td>{{ s.category }}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h3>Your Availability Slots</h3>
<a href="{% url 'providers:add_slot' %}" class="btn">➕ Add Slot</a>

<table class="list-table">
    <tr>
        <th>Service</th>
        <th>Date</th>
        <th>From</th>
        <th>To</th>
        <th>Actions</th>
    </tr>
    {% for slot in slots %}
    <tr>
        <td>{{ slot.service.title }}</td>
        <td>{{ slot.date }}</td>
        <td>{{ slot.start_time }}</td>
        <td>{{ slot.end_time }}</td>
        <td>
            <a href="{% url 'providers:edit_slot' slot.id %}" class="btn">Edit</a>
            <a href="{% url 'providers:delete_slot' slot.id %}" class="btn btn-danger" 
               onclick="return confirm('Are you sure you want to delete this slot?');">Delete</a>
        </td>
    </tr>
    {% endfor %}
</table>


<hr>

<h3>Booked Customers</h3>
<a href="{% url 'providers:booked_customers' %}" class="btn">View All Booked Customers</a>

{% if recent_bookings %}
<table class="list-table">
    <tr>
        <th>Customer Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Service</th>
        <th>Booking Date</th>
        <th>Slot</th>
    </tr>
    {% for booking in recent_bookings %}
    <tr>
        <td>{{ booking.customer_name }}</td>
        <td>{{ booking.customer_email }}</td>
        <td>{{ booking.customer_phone }}</td>
        <td>{{ booking.slot.service.title }}</td>
        <td>{{ booking.booked_at|date:"Y-m-d H:i" }}</td>
        <td>{{ booking.slot.start_time }} - {{ booking.slot.end_time }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>No recent bookings yet.</p>
{% endif %}

{% endblock %}
